---
layout: post
title: "B-tree"
modified:
categories: blog
excerpt:
tags: []
image:
  feature:
date: 2015-07-23T21:48:58+08:00
---

## B - tree

B树相当于二叉查找树从两子节点到多子节点的推广和泛化。相对于自平衡二叉查找树，B树是针对读写大块数据的系统进行了优化的，更适合于外部存储器，常用语数据库和文件系统。

## Overview

在B树中，内部（非叶子）节点具有预定范围内可变数量的子节点。当对节点插入或删除数据时，会改变其子节点个数。为了满足预定的范围，内部节点会合并或分裂。因为允许一定范围的子节点，B树无需像其他自平衡查找树一样频繁进行自平衡，但是会浪费一些空间，因为节点并非全部存满数据。在特定的实现中，子节点数量的下限和上限通常是固定的。例如，在2-3 B树中（通常简称为2-3树），每个内部节点只有2或3个子节点。

B树的每个内部节点会包含若干key。key用于分开其子树。例如，如果内部节点有3个子节点（或子树），那么它就必须有2个key：a1和a2。左子树所有节点的key小于a1，中间子树所有节点的key介于a1和a2之间，右子树所有节点的key大于a2。

通常，key的数量在**d**和**2d**之间，**d**是key的最小数量，**d+1**是树的最小度或分支因子，实际上，key占用了节点中的大部分空间。因子2保证节点可以分裂或合并。如果内部节点具有**2d**个key，那么向其增加一个key，可以通过将此**2d**个key的节点分裂为两个**d**个key的节点，将新的key加入父节点。分裂后的每个节点中的key数量满足要求的最小key数量。类似，如果一个节点与其相邻节点都有**d**个key，那么可以删除节点中的一个key，然后让此**d-1**个key的节点与其相邻的**d**个key的节点合并，再加上从父节点取下来的一个key，组成新的**2d**个key的节点。

节点的分支个数（子节点数）比其所存的key多一个。在2-3树中，内部节点可以存一个key（两个子节点）或两个key（三个子节点）。通常使用**(d+1)-(2d+1)**或最高分支度**(2d+1)**来表示B树。

B树通过保持所有叶子节点在同一深度来保持平衡。随着新的key加入，深度会缓慢增加，但是整体深度很少增加，而且整体深度增加的结果是所有叶子节点都远离根节点一个深度。

对于查找节点数据所用时间远大于处理数据所用时间时，B树相对于其他可替代方案具有明显的优势。所以其适用于外存储器，例如磁盘。通过最大化每个内部节点的key数量，树的高度降低，减少了耗时数据访问的次数。此外，树的重新平衡很少发生。子节点的数量上限，取决于每个子节点存储的必要信息、磁盘块大小。虽然2-3树很容易解释，但是利用外存储器的实用B树需要大量的子节点以提高性能。

## Variants

通常的B树仅在内部节点存储key，在叶子节点不存储key。B树包括一些变种，例如B+树和B*树。

* 在B+树中，内部节点存储的是key的副本；key和record都记录在叶子节点；此外，叶子节点会包括指向下一个叶子节点的指针以加速顺序访问（遍历、范围查找等）。
* B*树对更多的相邻内部节点进行平衡，以保持内部节点更紧凑。此变种要求非root节点至少2/3的空间被占用，而非1/2。为了保持，在节点满时并非立即分裂节点，而是将其key分给其他相邻节点。当两个节点都满了，则分裂为三个节点。节点的删除比插入更复杂。
* B树可以变成顺序统计树，以key的顺序搜索第N条记录，或者统计两条记录之间的记录个数，或者其他操作。